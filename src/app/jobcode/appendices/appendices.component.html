<div class="container-fluid">
    <app-nav></app-nav>
</div>
<div class="container-fluid mt-3">
    <!-- Sticky header -->
    <div class="d-flex justify-content-end align-items-center mb-3 mt-3 p-2 bg-white shadow-sm">
        <div class="mr-2">
            <button class="btn p-0 border-0 bg-transparent" onclick="location.reload()" title="Refresh">
                <i class="bi bi-arrow-clockwise fs-4 text-success"></i>
            </button>
        </div>

        <button class="btn btn-sm mr-2"
            [ngClass]="activeCategory === 'electronics' ? 'btn-success shadow-none' : 'btn-outline-success'"
            (click)="alert('alert Workking')">
            Alert
        </button>

        <button class="btn btn-sm mr-2"
            [ngClass]="activeCategory === 'electronics' ? 'btn-success shadow-none' : 'btn-outline-success'"
            (click)="sortData('electronics')">
            Electronics
        </button>

        <button class="btn btn-sm mr-2"
            [ngClass]="activeCategory === 'jewelery' ? 'btn-success shadow-none' : 'btn-outline-success'"
            (click)="sortData('jewelery')">
            Jewelery
        </button>

        <button class="btn btn-sm mr-2"
            [ngClass]="activeCategory === 'men\'s clothing' ? 'btn-success shadow-none' : 'btn-outline-success'"
            (click)="sortData('men\'s clothing')">
            Men's clothing
        </button>

        <button class="btn btn-sm mr-3"
            [ngClass]="activeCategory === 'women\'s clothing' ? 'btn-success shadow-none' : 'btn-outline-success'"
            (click)="sortData('women\'s clothing')">
            Women's clothing
        </button>

        <div class="position-relative" style="cursor: pointer;" (click)="toggleCart()">
            <i class="bi bi-cart3" style="font-size: 1.5rem;"></i>
            <span *ngIf="cartItems.length > 0"
                class="position-absolute top-0 start-100 translate-middle badge text-white rounded-pill bg-danger">
                {{ cartItems.length }}
            </span>
        </div>
    </div>
    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-xl-5 g-3">
        <div class="col mb-2" *ngFor="let item of resDAta">
            <div class="card h-100 border-light shadow-sm p-2" style="font-size: 0.85rem;"
                (click)="getInfo(item,$event)">
                <img [src]="item.image" class="card-img-top" alt="{{ item.title }}"
                    style="height: 120px; object-fit: contain;" />
                <div class="card-body p-2">
                    <div class="mb-1 fw-semibold text-truncate" title="{{ item.title }}">
                        {{ item.title }}
                    </div>
                    <div class="text-muted small mb-2">
                        {{ item.description | slice: 0:40 }}...
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-primary">${{ item.price }}</span>
                        <span class="text-warning">{{ item.rating.rate }}⭐</span>
                    </div>
                    <div class="d-flex gap-1">
                        <button class="btn btn-sm btn-outline-primary flex-fill mr-2"
                            (click)="addToCart(item, $event)">Cart</button>
                        <button class="btn btn-sm btn-success flex-fill" (click)="buyNow(item,$event)">Buy</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div *ngIf="showCart" class="card position-absolute" style="width: 300px; right: 0; top: 8.5rem; z-index: 1050;">
    <div class="card-header">
        <strong>Cart Items</strong>
        <button type="button" class="btn-close float-end" aria-label="Close" (click)="toggleCart()"></button>
    </div>
    <ul class="list-group list-group-flush" style="max-height: 300px; overflow-y: auto;">
        <li *ngFor="let item of cartItems; let i = index"
            class="list-group-item d-flex justify-content-between align-items-center">
            {{ item.title | slice:0:20 }}...
            <span>${{ item.price }}</span>
            <button class="btn btn-sm btn-danger ms-2" (click)="removeFromCart(i)">×</button>
        </li>
        <li *ngIf="cartItems.length === 0" class="list-group-item text-center text-muted">
            Cart is empty.
        </li>
    </ul>
</div>

<ng-template #getSingleData>
    <div *ngIf="GetData" class="card shadow-sm p-3 my-3" style="max-width: 700px; font-size: 0.9rem;">
        <div class="row g-3 align-items-center">
            <div class="col-md-4">
                <img [src]="GetData.image" [alt]="GetData.title" class="img-fluid rounded"
                    style="height: 180px; object-fit: contain; width: 100%;" />
            </div>
            <div class="col-md-8 d-flex flex-column">
                <h5 class="card-title mb-2">{{ GetData.title }}</h5>
                <p class="text-muted small text-capitalize mb-1">Category: {{ GetData.category }}</p>
                <h6 class="text-primary mb-3">${{ GetData.price }}</h6>
                <p class="card-text mb-3" style="flex-grow: 1; overflow-y: auto; max-height: 100px;">
                    {{ GetData.description }}
                </p>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <span class="badge bg-warning text-dark fs-6">{{ GetData.rating.rate }} ⭐</span>
                        <small class="text-muted ms-1">({{ GetData.rating.count }} reviews)</small>
                    </div>
                    <button class="btn btn-success btn-sm border-none shadow-none"
                        (click)="addToCart(GetData,$event)">Add to
                        Cart</button>
                </div>
            </div>
        </div>
    </div>
</ng-template>


<ng-template #jobDialog>
    <div *ngIf="selectedItemForPayment" class="mt-4">
        <h5>Payment Details</h5>
        <div class="card p-3">
            <div class="d-flex align-items-center mb-2">
                <img [src]="selectedItemForPayment.image" alt="product"
                    style="height: 80px; object-fit: contain; margin-right: 1rem;">
                <div>
                    <h6>{{ selectedItemForPayment.title }}</h6>
                    <p class="small text-muted mb-1">{{ selectedItemForPayment.description | slice:0:100 }}...</p>
                    <strong>Price: ${{ selectedItemForPayment.price }}</strong>
                </div>
            </div>

            <form (submit)="makePayment()">
                <div class="mb-2">
                    <label>Card Number</label>
                    <input class="form-control" placeholder="1234 5678 9012 3456" required>
                </div>
                <div class="mb-2">
                    <label>Name on Card</label>
                    <input class="form-control" required>
                </div>
                <div class="d-flex gap-2 mb-2">
                    <input class="form-control" placeholder="MM/YY" required>
                    <input class="form-control" placeholder="CVV" required>
                </div>
                <button type="submit" class="btn btn-primary w-100" (click)="close()">Pay ${{
                    selectedItemForPayment.price }}</button>
            </form>
        </div>
    </div>
</ng-template>

<div class="loader-overlay" *ngIf="isLoading">
    <img src="https://loading.io/assets/mod/spinner/spinner/lg.gif" alt="Loading..." class="loader-img">
</div>

<div *ngIf="showAlert" class="custom-alert alert alert-warning alert-dismissible fade show slide-in" role="alert">
    <strong>Warning!</strong> {{ alertMessage }}
    <button type="button" class="close" aria-label="Close" (click)="closeAlert()">
        <span aria-hidden="true">&times;</span>
    </button>
</div>